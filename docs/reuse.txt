# SO_REUSEPORT vs SO_REUSEADDR: TCP & UDP Complete Guide

## Quick Comparison Table

| Feature | SO_REUSEADDR | SO_REUSEPORT |
|---------|--------------|--------------|
| **TCP Purpose** | Reuse address after TIME_WAIT | Multiple processes, load balance connections |
| **UDP Purpose** | Multiple binds to same port | Multiple processes, load balance datagrams |
| **Multi-process** | âŒ No (TCP), âš ï¸ Limited (UDP) | âœ… Yes (both) |
| **Load balancing** | âŒ No | âœ… Yes (kernel-level) |
| **TIME_WAIT bypass** | âœ… Yes (TCP only) | âœ… Yes (TCP) |
| **Typical use** | Server restart | Multi-core scaling |

---

# PART 1: TCP (Connection-Oriented)

## SO_REUSEADDR with TCP

### The TCP TIME_WAIT Problem

```
TCP CONNECTION LIFECYCLE:

Client                          Server
  â”‚                               â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€ SYN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚  ESTABLISHED
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€ SYN-ACK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€ ACK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                               â”‚
  â”‚â•â•â•â•â•â•â• DATA TRANSFER â•â•â•â•â•â•â•â•â•â”‚
  â”‚                               â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€ FIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚  FIN_WAIT_1
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€ ACK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  FIN_WAIT_2
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€ FIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  TIME_WAIT â°
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€ ACK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                               â”‚
  â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                          â”‚ TIME_WAIT  â”‚ 
  â”‚                          â”‚ 2*MSL      â”‚ â† Usually 60-240 seconds
  â”‚                          â”‚ (2-4 min)  â”‚
  â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚                               â”‚
  â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                          â”‚   CLOSED   â”‚
  â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### WITHOUT SO_REUSEADDR (TCP)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TIME: T0 - Server Running                          â”‚
â”‚                                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚  TCP Server (Port 8080)            â”‚          â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚
â”‚    â”‚  â”‚ Active Connections:          â”‚  â”‚          â”‚
â”‚    â”‚  â”‚ Client A: 192.168.1.5:45001  â”‚  â”‚          â”‚
â”‚    â”‚  â”‚ Client B: 192.168.1.6:45002  â”‚  â”‚          â”‚
â”‚    â”‚  â”‚ Client C: 192.168.1.7:45003  â”‚  â”‚          â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TIME: T1 - Server Stopped (kill -9 or Ctrl+C)     â”‚
â”‚                                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚  Process Terminated â˜ ï¸              â”‚          â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚
â”‚    â”‚  â”‚ Sockets in TIME_WAIT:        â”‚  â”‚          â”‚
â”‚    â”‚  â”‚ â€¢ 0.0.0.0:8080 (listening)   â”‚  â”‚          â”‚
â”‚    â”‚  â”‚ â€¢ 3 client connections       â”‚  â”‚          â”‚
â”‚    â”‚  â”‚ â° All blocked for 2-4 min    â”‚  â”‚          â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TIME: T2 - Try Immediate Restart                   â”‚
â”‚                                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚  New Process Attempts Start        â”‚          â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚
â”‚    â”‚  â”‚ socket(AF_INET, SOCK_STREAM) â”‚  â”‚          â”‚
â”‚    â”‚  â”‚ bind(0.0.0.0:8080)           â”‚  â”‚          â”‚
â”‚    â”‚  â”‚                              â”‚  â”‚          â”‚
â”‚    â”‚  â”‚ âŒ ERROR: EADDRINUSE         â”‚  â”‚          â”‚
â”‚    â”‚  â”‚ "Address already in use"     â”‚  â”‚          â”‚
â”‚    â”‚  â”‚                              â”‚  â”‚          â”‚
â”‚    â”‚  â”‚ ğŸ˜¢ Must wait 2-4 minutes!    â”‚  â”‚          â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### WITH SO_REUSEADDR (TCP)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TIME: T0 - Server Running with SO_REUSEADDR        â”‚
â”‚                                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚  TCP Server (Port 8080)            â”‚          â”‚
â”‚    â”‚  setsockopt(SO_REUSEADDR) âœ…       â”‚          â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚
â”‚    â”‚  â”‚ Active Connections:          â”‚  â”‚          â”‚
â”‚    â”‚  â”‚ Client A: 192.168.1.5:45001  â”‚  â”‚          â”‚
â”‚    â”‚  â”‚ Client B: 192.168.1.6:45002  â”‚  â”‚          â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TIME: T1 - Server Stopped                          â”‚
â”‚                                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚  Process Terminated â˜ ï¸              â”‚          â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚
â”‚    â”‚  â”‚ Sockets in TIME_WAIT:        â”‚  â”‚          â”‚
â”‚    â”‚  â”‚ â€¢ Old connections lingering  â”‚  â”‚          â”‚
â”‚    â”‚  â”‚ â° But port can be reused!    â”‚  â”‚          â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TIME: T2 - Immediate Restart (SUCCESS!)            â”‚
â”‚                                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚  New Process Starts                â”‚          â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚
â”‚    â”‚  â”‚ socket(AF_INET, SOCK_STREAM) â”‚  â”‚          â”‚
â”‚    â”‚  â”‚ setsockopt(SO_REUSEADDR)     â”‚  â”‚          â”‚
â”‚    â”‚  â”‚ bind(0.0.0.0:8080)           â”‚  â”‚          â”‚
â”‚    â”‚  â”‚                              â”‚  â”‚          â”‚
â”‚    â”‚  â”‚ âœ… SUCCESS!                  â”‚  â”‚          â”‚
â”‚    â”‚  â”‚ Listening immediately!       â”‚  â”‚          â”‚
â”‚    â”‚  â”‚                              â”‚  â”‚          â”‚
â”‚    â”‚  â”‚ ğŸ‰ Zero downtime!             â”‚  â”‚          â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### TCP Code Example

```c
// TCP Server with SO_REUSEADDR
int tcp_sock = socket(AF_INET, SOCK_STREAM, 0);

int reuse = 1;
setsockopt(tcp_sock, SOL_SOCKET, SO_REUSEADDR, &reuse, sizeof(reuse));

struct sockaddr_in addr;
addr.sin_family = AF_INET;
addr.sin_port = htons(8080);
addr.sin_addr.s_addr = INADDR_ANY;

bind(tcp_sock, (struct sockaddr*)&addr, sizeof(addr));  // âœ… Works even during TIME_WAIT
listen(tcp_sock, SOMAXCONN);
```

## SO_REUSEPORT with TCP

### TCP Load Balancing Across Processes

```
WITHOUT SO_REUSEPORT (TCP):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Traditional approach: Single accept() queue        â”‚
â”‚                                                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚         â”‚   Listen Socket         â”‚                â”‚
â”‚         â”‚   Port 8080             â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                     â”‚                              â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚         â”‚  Accept Queue (Kernel)  â”‚                â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”     â”‚                â”‚
â”‚         â”‚  â”‚C1 â”‚ â”‚C2 â”‚ â”‚C3 â”‚     â”‚ â† All connections here
â”‚         â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜     â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                     â”‚                              â”‚
â”‚              accept() calls                        â”‚
â”‚                     â”‚                              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚    â”‚                â”‚                â”‚            â”‚
â”‚    â–¼                â–¼                â–¼            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”         â”‚
â”‚ â”‚Threadâ”‚        â”‚Threadâ”‚        â”‚Threadâ”‚         â”‚
â”‚ â”‚  1   â”‚        â”‚  2   â”‚        â”‚  3   â”‚         â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                     â”‚
â”‚ Problem: All threads compete for same lock! ğŸ”’     â”‚
â”‚ Result: Lock contention, cache misses, slower ğŸŒ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
WITH SO_REUSEPORT (TCP):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Modern approach: Multiple independent queues       â”‚
â”‚                                                     â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚              â”‚  Kernel Network     â”‚               â”‚
â”‚              â”‚  Stack              â”‚               â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                         â”‚                          â”‚
â”‚           Hash-based distribution                  â”‚
â”‚           (src_ip, src_port,                       â”‚
â”‚            dst_ip, dst_port)                       â”‚
â”‚                         â”‚                          â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚        â”‚                â”‚                â”‚         â”‚
â”‚        â–¼                â–¼                â–¼         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Socket 1 â”‚     â”‚ Socket 2 â”‚     â”‚ Socket 3 â”‚  â”‚
â”‚  â”‚Port 8080 â”‚     â”‚Port 8080 â”‚     â”‚Port 8080 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚                â”‚                â”‚         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Accept   â”‚     â”‚ Accept   â”‚     â”‚ Accept   â”‚  â”‚
â”‚  â”‚ Queue    â”‚     â”‚ Queue    â”‚     â”‚ Queue    â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”    â”‚     â”‚ â”Œâ”€â”€â”€â”    â”‚     â”‚ â”Œâ”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚ â”‚C1 â”‚    â”‚     â”‚ â”‚C4 â”‚    â”‚     â”‚ â”‚C7 â”‚    â”‚  â”‚
â”‚  â”‚ â”‚C2 â”‚    â”‚     â”‚ â”‚C5 â”‚    â”‚     â”‚ â”‚C8 â”‚    â”‚  â”‚
â”‚  â”‚ â”‚C3 â”‚    â”‚     â”‚ â”‚C6 â”‚    â”‚     â”‚ â”‚C9 â”‚    â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”˜    â”‚     â”‚ â””â”€â”€â”€â”˜    â”‚     â”‚ â””â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚                â”‚                â”‚         â”‚
â”‚        â–¼                â–¼                â–¼         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Process 1 â”‚     â”‚Process 2 â”‚     â”‚Process 3 â”‚  â”‚
â”‚  â”‚ CPU 0    â”‚     â”‚ CPU 1    â”‚     â”‚ CPU 2    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â”‚ Benefits:                                          â”‚
â”‚ âœ… No lock contention!                             â”‚
â”‚ âœ… Better CPU cache utilization                    â”‚
â”‚ âœ… Linear scalability with cores                   â”‚
â”‚ âœ… Same client â†’ same process (session affinity)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### TCP Connection Distribution

```
Connection Routing Example:

Client 1 (192.168.1.100:50001) connects to Server:8080
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Kernel computes hash:                  â”‚
â”‚ hash(192.168.1.100, 50001,            â”‚
â”‚      10.0.0.1, 8080) = 0xABCD         â”‚
â”‚                                        â”‚
â”‚ 0xABCD % 3 processes = 0              â”‚
â”‚                                        â”‚
â”‚ Route to â†’ Process 1 âœ…               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Client 2 (192.168.1.101:50002) connects to Server:8080
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ hash(192.168.1.101, 50002,            â”‚
â”‚      10.0.0.1, 8080) = 0x1234         â”‚
â”‚                                        â”‚
â”‚ 0x1234 % 3 processes = 1              â”‚
â”‚                                        â”‚
â”‚ Route to â†’ Process 2 âœ…               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Client 1 reconnects (same IP, different port):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ hash(192.168.1.100, 60001,            â”‚
â”‚      10.0.0.1, 8080) = 0xEF01         â”‚
â”‚                                        â”‚
â”‚ 0xEF01 % 3 processes = 0              â”‚
â”‚                                        â”‚
â”‚ Route to â†’ Process 1 âœ… (Same!)       â”‚
â”‚ Good for session affinity!             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### TCP Code Example

```c
// TCP Server with SO_REUSEPORT (each process runs this)
int tcp_sock = socket(AF_INET, SOCK_STREAM, 0);

int reuse_port = 1;
setsockopt(tcp_sock, SOL_SOCKET, SO_REUSEPORT, &reuse_port, sizeof(reuse_port));

// Optional: Also use SO_REUSEADDR for fast restarts
int reuse_addr = 1;
setsockopt(tcp_sock, SOL_SOCKET, SO_REUSEADDR, &reuse_addr, sizeof(reuse_addr));

struct sockaddr_in addr;
addr.sin_family = AF_INET;
addr.sin_port = htons(8080);
addr.sin_addr.s_addr = INADDR_ANY;

bind(tcp_sock, (struct sockaddr*)&addr, sizeof(addr));
listen(tcp_sock, SOMAXCONN);

// Each process accepts connections from its own queue!
while (1) {
    int client = accept(tcp_sock, NULL, NULL);
    // Handle client...
}
```

---

# PART 2: UDP (Connectionless)

## UDP Fundamentals

```
UDP vs TCP:

TCP (Connection-Oriented):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client          Server                 â”‚
â”‚   â”‚ SYN            â”‚                   â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                   â”‚
â”‚   â”‚ SYN-ACK        â”‚                   â”‚
â”‚   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
â”‚   â”‚ ACK            â”‚                   â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                   â”‚
â”‚   â”‚                â”‚                   â”‚
â”‚   â”‚ [Connected]    â”‚                   â”‚
â”‚   â”‚                â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

UDP (Connectionless):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client          Server                 â”‚
â”‚   â”‚                â”‚                   â”‚
â”‚   â”‚ Datagram 1     â”‚                   â”‚
â”‚   â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â†’â”‚ â† Just send!      â”‚
â”‚   â”‚ Datagram 2     â”‚                   â”‚
â”‚   â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â†’â”‚ â† No handshake    â”‚
â”‚   â”‚ Datagram 3     â”‚                   â”‚
â”‚   â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â†’â”‚ â† Independent     â”‚
â”‚   â”‚                â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Key Difference: UDP has NO TIME_WAIT state!
```

## SO_REUSEADDR with UDP

### UDP Behavior (Different from TCP!)

```
UDP WITH SO_REUSEADDR:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SO_REUSEADDR allows MULTIPLE processes to bind to   â”‚
â”‚ the SAME UDP port (different behavior than TCP!)    â”‚
â”‚                                                     â”‚
â”‚ Process 1:                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚ â”‚ socket(AF_INET, SOCK_DGRAM)     â”‚                â”‚
â”‚ â”‚ setsockopt(SO_REUSEADDR)        â”‚                â”‚
â”‚ â”‚ bind(0.0.0.0:5000)              â”‚                â”‚
â”‚ â”‚ âœ… Binds successfully            â”‚                â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                     â”‚
â”‚ Process 2:                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚ â”‚ socket(AF_INET, SOCK_DGRAM)     â”‚                â”‚
â”‚ â”‚ setsockopt(SO_REUSEADDR)        â”‚                â”‚
â”‚ â”‚ bind(0.0.0.0:5000)              â”‚                â”‚
â”‚ â”‚ âœ… ALSO binds successfully!      â”‚                â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                     â”‚
â”‚ Process 3:                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚ â”‚ socket(AF_INET, SOCK_DGRAM)     â”‚                â”‚
â”‚ â”‚ setsockopt(SO_REUSEADDR)        â”‚                â”‚
â”‚ â”‚ bind(0.0.0.0:5000)              â”‚                â”‚
â”‚ â”‚ âœ… ALSO binds successfully!      â”‚                â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                     â”‚
â”‚ âš ï¸  But packet delivery is UNPREDICTABLE!          â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### UDP Packet Delivery with SO_REUSEADDR

```
UNPREDICTABLE BEHAVIOR:

Incoming UDP packet to port 5000:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Network Stack receives packet       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        Random delivery!
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”
       â”‚       â”‚       â”‚
       â–¼       â–¼       â–¼
   â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
   â”‚Proc1â”‚ â”‚Proc2â”‚ â”‚Proc3â”‚
   â”‚Got âœ…â”‚ â”‚ No âŒâ”‚ â”‚ No âŒâ”‚
   â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜

Next packet:
       â–¼       â–¼       â–¼
   â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
   â”‚Proc1â”‚ â”‚Proc2â”‚ â”‚Proc3â”‚
   â”‚ No âŒâ”‚ â”‚Got âœ…â”‚ â”‚ No âŒâ”‚
   â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜

Next packet:
       â–¼       â–¼       â–¼
   â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
   â”‚Proc1â”‚ â”‚Proc2â”‚ â”‚Proc3â”‚
   â”‚ No âŒâ”‚ â”‚ No âŒâ”‚ â”‚Got âœ…â”‚
   â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜

âš ï¸  Distribution is RANDOM and UNDEFINED!
âš ï¸  One process might get all packets!
âš ï¸  Packets might go to different processes!
```

### UDP Multicast with SO_REUSEADDR

```
UDP MULTICAST - Proper use case for SO_REUSEADDR:

Scenario: Multiple processes want to receive same multicast stream

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Multicast Sender: 239.1.1.1:5000                  â”‚
â”‚  Sending video stream                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ Multicast packets
                   â”‚ (copies made by network/kernel)
                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚              â”‚              â”‚
    â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Monitor â”‚    â”‚Logger  â”‚    â”‚Analyzerâ”‚
â”‚Process â”‚    â”‚Process â”‚    â”‚Process â”‚
â”‚        â”‚    â”‚        â”‚    â”‚        â”‚
â”‚Displaysâ”‚    â”‚Records â”‚    â”‚Stats   â”‚
â”‚video   â”‚    â”‚packets â”‚    â”‚metrics â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

All three processes receive SAME packets! âœ…

Code:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ setsockopt(SO_REUSEADDR)            â”‚
â”‚ bind(0.0.0.0:5000)                  â”‚
â”‚                                     â”‚
â”‚ // Join multicast group             â”‚
â”‚ struct ip_mreq mreq;                â”‚
â”‚ mreq.imr_multiaddr = 239.1.1.1;     â”‚
â”‚ setsockopt(IP_ADD_MEMBERSHIP...)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### UDP Code Example (SO_REUSEADDR)

```c
// UDP Server with SO_REUSEADDR (for multicast)
int udp_sock = socket(AF_INET, SOCK_DGRAM, 0);

int reuse = 1;
setsockopt(udp_sock, SOL_SOCKET, SO_REUSEADDR, &reuse, sizeof(reuse));

struct sockaddr_in addr;
addr.sin_family = AF_INET;
addr.sin_port = htons(5000);
addr.sin_addr.s_addr = INADDR_ANY;

bind(udp_sock, (struct sockaddr*)&addr, sizeof(addr));

// For multicast:
struct ip_mreq mreq;
inet_pton(AF_INET, "239.1.1.1", &mreq.imr_multiaddr);
mreq.imr_interface.s_addr = INADDR_ANY;
setsockopt(udp_sock, IPPROTO_IP, IP_ADD_MEMBERSHIP, &mreq, sizeof(mreq));
```

## SO_REUSEPORT with UDP

### UDP Load Balancing with SO_REUSEPORT

```
UDP WITH SO_REUSEPORT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Kernel provides DETERMINISTIC load balancing!      â”‚
â”‚                                                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚         â”‚   Network Stack         â”‚                â”‚
â”‚         â”‚   Receives UDP packet   â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                     â”‚                              â”‚
â”‚         Hash-based distribution                    â”‚
â”‚         hash(src_ip, src_port,                     â”‚
â”‚              dst_ip, dst_port)                     â”‚
â”‚                     â”‚                              â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚        â”‚            â”‚            â”‚                 â”‚
â”‚        â–¼            â–¼            â–¼                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚Socket 1â”‚  â”‚Socket 2â”‚  â”‚Socket 3â”‚             â”‚
â”‚   â”‚Port    â”‚  â”‚Port    â”‚  â”‚Port    â”‚             â”‚
â”‚   â”‚5000    â”‚  â”‚5000    â”‚  â”‚5000    â”‚             â”‚
â”‚   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜             â”‚
â”‚       â”‚           â”‚           â”‚                    â”‚
â”‚       â–¼           â–¼           â–¼                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚Process â”‚  â”‚Process â”‚  â”‚Process â”‚             â”‚
â”‚   â”‚   1    â”‚  â”‚   2    â”‚  â”‚   3    â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                     â”‚
â”‚ âœ… Consistent hashing ensures:                     â”‚
â”‚    â€¢ Same source always goes to same process       â”‚
â”‚    â€¢ Even distribution across processes            â”‚
â”‚    â€¢ No packet duplication                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### UDP Datagram Distribution

```
PREDICTABLE LOAD BALANCING:

Client A (10.0.0.5:40001) sends to Server:5000
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ hash(10.0.0.5, 40001,                 â”‚
â”‚      192.168.1.1, 5000) = 0xABC       â”‚
â”‚ 0xABC % 3 = 0                         â”‚
â”‚ â†’ Process 1 âœ…                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Client A sends another packet (same source):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ hash(10.0.0.5, 40001,                 â”‚
â”‚      192.168.1.1, 5000) = 0xABC       â”‚
â”‚ 0xABC % 3 = 0                         â”‚
â”‚ â†’ Process 1 âœ… (SAME process!)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Client B (10.0.0.6:40002) sends to Server:5000
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ hash(10.0.0.6, 40002,                 â”‚
â”‚      192.168.1.1, 5000) = 0x1234      â”‚
â”‚ 0x1234 % 3 = 1                        â”‚
â”‚ â†’ Process 2 âœ…                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Result: Session affinity maintained! ğŸ¯
```

### UDP Performance Comparison

```
WITHOUT SO_REUSEPORT (single process):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Single UDP socket                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Receive Queue (limited size)    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”       â”‚  â”‚
â”‚  â”‚  â”‚Pkt1â”‚â”‚Pkt2â”‚â”‚Pkt3â”‚â”‚Pkt4â”‚ ...   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”˜       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                            â”‚
â”‚           â–¼                            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚    â”‚ Single Threadâ”‚                   â”‚
â”‚    â”‚ Processing   â”‚                   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                        â”‚
â”‚ Bottlenecks:                           â”‚
â”‚ âŒ Single core processing              â”‚
â”‚ âŒ Queue overflow (packet loss)        â”‚
â”‚ âŒ Limited throughput                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

WITH SO_REUSEPORT (multiple processes):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Multiple UDP sockets                  â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Queue 1  â”‚  â”‚ Queue 2  â”‚  ...     â”‚
â”‚  â”‚ â”Œâ”€â”€â”â”Œâ”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”â”Œâ”€â”€â” â”‚          â”‚
â”‚  â”‚ â”‚P1â”‚â”‚P2â”‚ â”‚  â”‚ â”‚P4â”‚â”‚P5â”‚ â”‚          â”‚
â”‚  â”‚ â””â”€â”€â”˜â””â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”˜â””â”€â”€â”˜ â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â”‚
â”‚        â”‚             â”‚                â”‚
â”‚        â–¼             â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚Process 1â”‚   â”‚Process 2â”‚   ...     â”‚
â”‚  â”‚ CPU 0   â”‚   â”‚ CPU 1   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                        â”‚
â”‚ Benefits:                              â”‚
â”‚ âœ… Multiple cores utilized             â”‚
â”‚ âœ… Larger effective queue size         â”‚
â”‚ âœ… Higher throughput                   â”‚
â”‚ âœ… Better packet loss prevention       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### UDP Code Example (SO_REUSEPORT)

```c
// UDP Server with SO_REUSEPORT (each process runs this)
int udp_sock = socket(AF_INET, SOCK_DGRAM, 0);

int reuse_port = 1;
setsockopt(udp_sock, SOL_SOCKET, SO_REUSEPORT, &reuse_port, sizeof(reuse_port));

struct sockaddr_in addr;
addr.sin_family = AF_INET;
addr.sin_port = htons(5000);
addr.sin_addr.s_addr = INADDR_ANY;

bind(udp_sock, (struct sockaddr*)&addr, sizeof(addr));

// Each process receives its share of packets!
char buffer[1024];
while (1) {
    struct sockaddr_in client_addr;
    socklen_t len = sizeof(client_addr);
    recvfrom(udp_sock, buffer, sizeof(buffer), 0, 
             (struct sockaddr*)&client_addr, &len);
    // Process packet...
}
```

---

# DETAILED COMPARISON: TCP vs UDP

## SO_REUSEADDR Comparison

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    SO_REUSEADDR BEHAVIOR                      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Feature          â”‚  TCP                â”‚  UDP                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Primary Use       â”‚ Skip TIME_WAIT      â”‚ Multiple binds      â•‘
â•‘ Multiple Binds    â”‚ âŒ No (one process) â”‚ âœ… Yes (many)       â•‘
â•‘ Packet Delivery   â”‚ N/A                 â”‚ âš ï¸  Unpredictable   â•‘
â•‘ TIME_WAIT Impact  â”‚ âœ… Bypasses it      â”‚ N/A (no TIME_WAIT)  â•‘
â•‘ Restart Server    â”‚ âœ… Immediate        â”‚ âœ… Immediate        â•‘
â•‘ Load Balancing    â”‚ âŒ No               â”‚ âŒ No (random)      â•‘
â•‘ Multicast         â”‚ N/A                 â”‚ âœ… Proper use case  â•‘
â•‘ Security Risk     â”‚ âš ï¸  Port hijacking  â”‚ âš ï¸  Port hijacking  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•§â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•§â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## SO_REUSEPORT Comparison

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    SO_REUSEPORT BEHAVIOR                      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Feature          â”‚  TCP                â”‚  UDP                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Primary Use       â”‚ Multi-core scaling  â”‚ Multi-core scaling  â•‘
â•‘ Multiple Binds    â”‚ âœ… Yes (many)       â”‚ âœ… Yes (many)       â•‘
â•‘ Load Balancing    â”‚ âœ… Kernel hashing   â”‚ âœ… Kernel hashing   â•‘
â•‘ Distribution      â”‚ Per-connection      â”‚ Per-datagram        â•‘
â•‘ Session Affinity  â”‚ âœ… Same clientâ†’     â”‚ âœ… Same sourceâ†’     â•‘
â•‘                   â”‚    same process     â”‚    same process     â•‘
â•‘ Queue Contention  â”‚ âœ… Eliminated       â”‚ âœ… Eliminated       â•‘
â•‘ Performance Gain  â”‚ ğŸš€ High             â”‚ ğŸš€ Very High        â•‘
â•‘ Complexity        â”‚ Moderate            â”‚ Low                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•§â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•§â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

# REAL-WORLD USE CASES

## TCP Use Cases

### 1. Web Server (NGINX)

```
NGINX with SO_REUSEPORT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Master Process                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Spawns 4 worker processes             â”‚  â”‚
â”‚  â”‚  Each with SO_REUSEPORT enabled        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       â”‚       â”‚       â”‚       â”‚
        â–¼       â–¼       â–¼       â–¼       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”
    â”‚Workerâ”‚â”‚Workerâ”‚â”‚Workerâ”‚â”‚Workerâ”‚
    â”‚  1   â”‚â”‚  2   â”‚â”‚  3   â”‚â”‚  4   â”‚
    â”‚:80   â”‚â”‚:80   â”‚â”‚:80   â”‚â”‚:80   â”‚
    â”‚CPU 0 â”‚â”‚CPU 1 â”‚â”‚CPU 2 â”‚â”‚CPU 3 â”‚
    â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜

Benefits:
â€¢ 4x parallelism for accept()
â€¢ No thundering herd problem
â€¢ Better cache locality
â€¢ Linear scaling with cores

Configuration:
listen 80 reuseport;
```

### 2. Database Connection Pool

```
PostgreSQL with SO_REUSEPORT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client requests arrive                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        Kernel distributes
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          â”‚          â”‚          â”‚
    â–¼          â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Backend â”‚â”‚Backend â”‚â”‚Backend â”‚â”‚Backend â”‚
â”‚   1    â”‚â”‚   2    â”‚â”‚   3    â”‚â”‚   4    â”‚
â”‚ :5432  â”‚â”‚ :5432  â”‚â”‚ :5432  â”‚â”‚ :5432  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â€¢ Each backend handles subset of connections
â€¢ Reduced lock contention on accept
â€¢ Better CPU utilization
```

## UDP Use Cases

### 1. DNS Server

```
DNS Server with SO_REUSEPORT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  High-volume DNS queries                     â”‚
â”‚  Millions of packets per second              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        Kernel distributes by
        hash(client_ip, client_port)
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          â”‚          â”‚          â”‚
    â–¼          â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Resolverâ”‚â”‚Resolverâ”‚â”‚Resolverâ”‚â”‚Resolverâ”‚
â”‚   1    â”‚â”‚   2    â”‚â”‚   3    â”‚â”‚   4    â”‚
â”‚  :53   â”‚â”‚  :53   â”‚â”‚  :53   â”‚â”‚  :53   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Benefits:
â€¢ Same client always hits same resolver
â€¢ Better cache hit rate (per-process cache)
â€¢ Massive throughput improvement
â€¢ Handles DNS amplification attacks better
```

### 2. Game Server

```
Real-time Multiplayer Game Server:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Players send position updates (UDP)         â”‚
â”‚  Low latency required!                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    Player session affinity maintained
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          â”‚          â”‚          â”‚
    â–¼          â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ World  â”‚â”‚ World  â”‚â”‚ World  â”‚â”‚ World  â”‚
â”‚ Region â”‚â”‚ Region â”‚â”‚ Region â”‚â”‚ Region â”‚
â”‚   1    â”‚â”‚   2    â”‚â”‚   3    â”‚â”‚   4    â”‚
â”‚ :9000  â”‚â”‚ :9000  â”‚â”‚ :9000  â”‚â”‚ :9000  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â€¢ Each player consistently routed to same region
â€¢ Maintains game state consistency
â€¢ High packet rate handling
â€¢ Low latency processing
```

### 3. Logging/Monitoring (syslog)

```
Syslog Server with SO_REUSEPORT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Thousands of servers sending logs           â”‚
â”‚  UDP packets flooding in                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          â”‚          â”‚          â”‚
    â–¼          â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Logger  â”‚â”‚Logger  â”‚â”‚Logger  â”‚â”‚Logger  â”‚
â”‚   1    â”‚â”‚   2    â”‚â”‚   3    â”‚â”‚   4    â”‚
â”‚  :514  â”‚â”‚  :514  â”‚â”‚  :514  â”‚â”‚  :514  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚         â”‚         â”‚         â”‚
    â–¼         â–¼         â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Distributed log processing        â”‚
â”‚  No packet drops                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Video Streaming (RTP/UDP)

```
Live Video Streaming:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Multiple video streams (RTP over UDP)       â”‚
â”‚  Each stream needs consistent handling       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        Stream affinity by source
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          â”‚          â”‚          â”‚
    â–¼          â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Handler â”‚â”‚Handler â”‚â”‚Handler â”‚â”‚Handler â”‚
â”‚   1    â”‚â”‚   2    â”‚â”‚   3    â”‚â”‚   4    â”‚
â”‚ :5004  â”‚â”‚ :5004  â”‚â”‚ :5004  â”‚â”‚ :5004  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â€¢ Same video stream â†’ same handler
â€¢ Maintains packet ordering per stream
â€¢ Efficient jitter buffer per process
â€¢ High bandwidth handling
```

---

# COMBINATION STRATEGIES

## Using Both Options Together

```
BEST PRACTICE: Combine SO_REUSEADDR + SO_REUSEPORT

TCP Example:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  setsockopt(SO_REUSEADDR)  â† Fast restart â”‚
â”‚  setsockopt(SO_REUSEPORT)  â† Load balance â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Benefits:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Can restart server immediately         â”‚
â”‚  âœ… Multiple workers for scaling           â”‚
â”‚  âœ… No TIME_WAIT blocking                  â”‚
â”‚  âœ… Kernel load balancing                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Code:
int sock = socket(AF_INET, SOCK_STREAM, 0);

int reuse_addr = 1;
int reuse_port = 1;

setsockopt(sock, SOL_SOCKET, SO_REUSEADDR, 
           &reuse_addr, sizeof(reuse_addr));
setsockopt(sock, SOL_SOCKET, SO_REUSEPORT, 
           &reuse_port, sizeof(reuse_port));

bind(sock, ...);
listen(sock, ...);
```

## Production Deployment Pattern

```
HIGH-AVAILABILITY WEB SERVER:

Step 1: Deploy initial workers
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Worker 1 (SO_REUSEADDR + SO_REUSEPORT)   â”‚
â”‚  Worker 2 (SO_REUSEADDR + SO_REUSEPORT)   â”‚
â”‚  Worker 3 (SO_REUSEADDR + SO_REUSEPORT)   â”‚
â”‚  Worker 4 (SO_REUSEADDR + SO_REUSEPORT)   â”‚
â”‚                                            â”‚
â”‚  All listening on :80                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 2: Rolling update (zero downtime)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stop Worker 1                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Workers 2, 3, 4 handle all traffic   â”‚  â”‚
â”‚  â”‚ (kernel redistributes automatically) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  Start Worker 1 (new version)              â”‚
â”‚  âœ… SO_REUSEADDR allows immediate bind     â”‚
â”‚                                            â”‚
â”‚  Repeat for Workers 2, 3, 4...            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Result: Zero downtime deployment! ğŸ‰
```

---

# PERFORMANCE BENCHMARKS

## TCP Performance

```
Single Process vs SO_REUSEPORT (4 cores):

Connections per Second:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                            â”‚
â”‚  Single Process:                           â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  20,000 conn/s  â”‚
â”‚                                            â”‚
â”‚  SO_REUSEPORT (4 workers):                 â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  75,000 conn/s  â”‚
â”‚                                            â”‚
â”‚  Improvement: 3.75x ğŸš€                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Latency (99th percentile):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Single Process:     50ms                  â”‚
â”‚  SO_REUSEPORT:       12ms                  â”‚
â”‚                                            â”‚
â”‚  Improvement: 4.2x faster ğŸš€               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## UDP Performance

```
Packets per Second (small packets):

Without SO_REUSEPORT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Single thread:                            â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  500K pps       â”‚
â”‚  (packet drops begin at this rate)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

With SO_REUSEPORT (4 processes):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4 processes:                              â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  2.5M pps       â”‚
â”‚  (linear scaling, no drops)                â”‚
â”‚                                            â”‚
â”‚  Improvement: 5x throughput ğŸš€             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Packet Loss Rate:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Without SO_REUSEPORT:  15% loss @ 1M pps â”‚
â”‚  With SO_REUSEPORT:      0% loss @ 2.5M   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# SECURITY CONSIDERATIONS

## Port Hijacking Risk

```
âš ï¸  SECURITY WARNING: SO_REUSEADDR

Vulnerability: Malicious process can hijack port

Attack Scenario:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Attacker's malicious process starts    â”‚
â”‚     setsockopt(SO_REUSEADDR)              â”‚
â”‚     bind(0.0.0.0:80)  â† Binds to all IPs  â”‚
â”‚                                            â”‚
â”‚  2. Legitimate server starts               â”‚
â”‚     setsockopt(SO_REUSEADDR)              â”‚
â”‚     bind(192.168.1.100:80)  â† Specific IP â”‚
â”‚                                            â”‚
â”‚  3. Traffic might go to BOTH! ğŸ˜±           â”‚
â”‚     - Some requests â†’ legitimate server    â”‚
â”‚     - Some requests â†’ attacker's process   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Protection:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Bind to specific IPs, not 0.0.0.0      â”‚
â”‚  âœ… Run with proper user permissions       â”‚
â”‚  âœ… Use SO_REUSEPORT instead (safer)       â”‚
â”‚  âœ… Implement port access controls         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## SO_REUSEPORT Security

```
âœ… SO_REUSEPORT is SAFER:

Protection Mechanism:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Kernel enforces:                          â”‚
â”‚  â€¢ Same UID required for all processes     â”‚
â”‚  â€¢ Same effective user only               â”‚
â”‚  â€¢ Prevents unauthorized hijacking        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Example:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Process 1 (UID 1000):                     â”‚
â”‚  setsockopt(SO_REUSEPORT)                 â”‚
â”‚  bind(:80) âœ…                              â”‚
â”‚                                            â”‚
â”‚  Process 2 (UID 1000):                     â”‚
â”‚  setsockopt(SO_REUSEPORT)                 â”‚
â”‚  bind(:80) âœ…  Same user, allowed         â”‚
â”‚                                            â”‚
â”‚  Process 3 (UID 1001):                     â”‚
â”‚  setsockopt(SO_REUSEPORT)                 â”‚
â”‚  bind(:80) âŒ  Different user, DENIED     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# QUICK DECISION GUIDE

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           WHICH SOCKET OPTION SHOULD I USE?               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                           â•‘
â•‘  Need to restart server quickly? (TCP)                   â•‘
â•‘  â””â”€â†’ Use SO_REUSEADDR                                    â•‘
â•‘                                                           â•‘
â•‘  Want multiple workers for performance? (TCP/UDP)        â•‘
â•‘  â””â”€â†’ Use SO_REUSEPORT                                    â•‘
â•‘                                                           â•‘
â•‘  Multicast application? (UDP)                            â•‘
â•‘  â””â”€â†’ Use SO_REUSEADDR                                    â•‘
â•‘                                                           â•‘
â•‘  High-traffic production server? (TCP/UDP)               â•‘
â•‘  â””â”€â†’ Use BOTH (SO_REUSEADDR + SO_REUSEPORT)              â•‘
â•‘                                                           â•‘
â•‘  Development/testing?                                     â•‘
â•‘  â””â”€â†’ Use SO_REUSEADDR (minimum)                          â•‘
â•‘                                                           â•‘
â•‘  Need session affinity?                                   â•‘
â•‘  â””â”€â†’ Use SO_REUSEPORT (provides it automatically)        â•‘
â•‘                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

# SUMMARY TABLE

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    COMPLETE COMPARISON                             â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Scenario              â”‚ TCP            â”‚ UDP                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ SERVER RESTART        â”‚                â”‚                           â•‘
â•‘ Fast restart needed   â”‚ SO_REUSEADDR âœ…â”‚ SO_REUSEADDR âœ…           â•‘
â•‘ Skip TIME_WAIT        â”‚ SO_REUSEADDR âœ…â”‚ N/A                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ PERFORMANCE SCALING   â”‚                â”‚                           â•‘
â•‘ Multi-core workers    â”‚ SO_REUSEPORT âœ…â”‚ SO_REUSEPORT âœ…           â•‘
â•‘ Load balancing        â”‚ SO_REUSEPORT âœ…â”‚ SO_REUSEPORT âœ…           â•‘
â•‘ Session affinity      â”‚ SO_REUSEPORT âœ…â”‚ SO_REUSEPORT âœ…           â•‘
â•‘ No lock contention    â”‚ SO_REUSEPORT âœ…â”‚ SO_REUSEPORT âœ…           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ SPECIAL CASES         â”‚                â”‚                           â•‘
â•‘ Multicast receive     â”‚ N/A            â”‚ SO_REUSEADDR âœ…           â•‘
â•‘ Multiple binds        â”‚ âŒ No          â”‚ SO_REUSEADDR âš ï¸           â•‘
â•‘                       â”‚                â”‚ (unpredictable)           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ PRODUCTION BEST       â”‚ BOTH OPTIONS âœ…â”‚ BOTH OPTIONS âœ…           â•‘
â•‘ PRACTICE              â”‚ SO_REUSEADDR + â”‚ SO_REUSEADDR +            â•‘
â•‘                       â”‚ SO_REUSEPORT   â”‚ SO_REUSEPORT              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•§â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•§â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**Golden Rule:** For production servers (both TCP and UDP), always use **BOTH** `SO_REUSEADDR` and `SO_REUSEPORT` for maximum flexibility, performance, and reliability!
